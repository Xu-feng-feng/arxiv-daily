name: Run Arxiv Papers Daily

on:
  workflow_dispatch:
  schedule:
    - cron: "0 */12 * * *"   # ç­‰ä»·äºæ¯å¤© 00:00/12:00 UTCï¼ˆJST=09:00/21:00ï¼‰

# è®© token å…·å¤‡å†™å…¥å†…å®¹çš„æƒé™ï¼Œä¾¿äºå›æ¨æ›´æ”¹
permissions:
  contents: write

jobs:
  build:
    name: update
    runs-on: ubuntu-latest

    # é˜²å¹¶å‘ï¼ˆåŒä¸€åˆ†æ”¯ä¸Šä¸€æ¬¡è¿˜åœ¨è·‘å°±å–æ¶ˆï¼‰
    concurrency:
      group: arxiv-daily-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: Checkout
        uses: actions/checkout@v4   # æˆ– @v5ï¼ˆè‹¥ä½ å·²éªŒè¯ï¼‰
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'              # ç¼“å­˜ pip ä¾èµ–

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install --upgrade arxiv requests pyyaml

      - name: Run daily arxiv
        env:
          # å»ºè®®ï¼šä½ çš„è„šæœ¬é‡Œä½¿ç”¨è‡ªå®šä¹‰ UA è®¿é—® arXiv
          ARXIV_USER_AGENT: "arxiv-daily (+https://github.com/Xu-feng-feng/arxiv-daily)"
        run: |
          python daily_arxiv.py

      - name: Commit & push updates
        uses: github-actions-x/commit@v2.9
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          push-branch: 'main'   # ğŸ”´ å…³é”®ï¼šæŒ‡å®šä½ çš„é»˜è®¤åˆ†æ”¯
          commit-message: "Github Action: Automatic Update Interested Arxiv Papers"
          files: |
            README.md
            docs/arxiv-daily.json
            docs/arxiv-daily-web.json
            docs/index.md
            docs/arxiv-daily-wechat.json
            docs/wechat.md
          rebase: 'true'
          name: ${{ env.GITHUB_USER_NAME }}
          email: ${{ env.GITHUB_USER_EMAIL }}
